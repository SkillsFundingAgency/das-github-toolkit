Import-Module $PSScriptRoot\..\src\GitHubToolKit.psm1 -Force

Describe "Set-GitHubRepoAutomatedSecurityFixes tests" -Tags @("Unit") {
    Context "All mandatory parameters are passed" {
        Mock Invoke-GitHubRestMethod -ModuleName GitHubToolKit -ParameterFilter { $Uri -match "\/orgs\/.*\/repos?type=all" } -MockWith {
            @(
                @{
                    id   = 12345678
                    name = "foo-bar-repo"
                },
                @{
                    id   = 87654321
                    name = "foo-foo-repo"
                }
            )
        }
        Mock Invoke-GitHubRestMethod -ModuleName GitHubToolKit -ParameterFilter { $Uri -match "\/orgs\/.*\/repos\/.*\/vulnerability-alerts" } -MockWith { Return $null }
        Mock Invoke-GitHubRestMethod -ModuleName GitHubToolKit -ParameterFilter { $Uri -match "\/orgs\/.*\/repos\/.*\/automated-security-fixes" } -MockWith { Return $null }

        It "All mandatory parameters are passed" {
            Set-GitHubSessionInformation -PatToken "not-a-real-pat-token"
            { Set-GitHubRepoVulnerabilitySettings -GitHubOrg "FooBarAgency" -RepoSearchString "foo-bar-repo" } | Should not throw
        }
    }
}
